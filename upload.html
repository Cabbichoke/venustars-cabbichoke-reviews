<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Review Bulk Upload</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
</head>
<body style="padding: 50px; font-family: sans-serif;">
    <h2>ğŸš€ ë¦¬ë·° ì—‘ì…€(CSV) ì¼ê´„ ì—…ë¡œë“œ</h2>
    <p>1. ì—‘ì…€ì„ <b>CSV(ì‰¼í‘œë¡œ ë¶„ë¦¬)</b> í˜•ì‹ìœ¼ë¡œ ì €ì¥í•˜ì„¸ìš”.<br>
       2. íŒŒì¼ ì œëª©ì´ <b>êµ¬ë§¤ì í‰ì , ë¦¬ë·°ìƒì„¸ë‚´ìš©, ë“±ë¡ì, ë¦¬ë·°ë“±ë¡ì¼</b>ì¸ì§€ í™•ì¸í•˜ì„¸ìš”.</p>
    
    <input type="file" id="csvFile" accept=".csv" style="margin: 20px 0;"><br>
    <button onclick="uploadData()" style="padding: 10px 20px; cursor: pointer;">ì—…ë¡œë“œ ì‹œì‘</button>
    
    <div id="status" style="margin-top:20px; color: blue; font-weight: bold; font-size: 1.2em;"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBpqZEXkf6vq5cwpdeLADGTz8A0M3NKLjU",
            authDomain: "venustars.firebaseapp.com",
            projectId: "venustars",
            storageBucket: "venustars.firebasestorage.app",
            messagingSenderId: "171419456473",
            appId: "1:171419456473:web:d9b77b0608b5ef3201bfc8"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        window.uploadData = async function() {
            const fileInput = document.getElementById('csvFile');
            const status = document.getElementById('status');
            
            if (!fileInput.files[0]) {
                alert("íŒŒì¼ì„ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”!");
                return;
            }

            Papa.parse(fileInput.files[0], {
                header: true,
                skipEmptyLines: true,
                complete: async function(results) {
                    status.innerText = "ë°ì´í„° ì—…ë¡œë“œ ì¤€ë¹„ ì¤‘...";
                    let count = 0;

                    for (let row of results.data) {
                        // ì—‘ì…€(í•œê¸€) ë°ì´í„°ë¥¼ Firebase(ì˜ì–´ í•„ë“œ)ë¡œ ë³€í™˜í•˜ì—¬ ì „ì†¡
                        const firebaseData = {
                            rating: row['êµ¬ë§¤ì í‰ì '] || 5,
                            reviews: row['ë¦¬ë·°ìƒì„¸ë‚´ìš©'] || "",
                            id: row['ë“±ë¡ì'] || "ìµëª…",
                            date: row['ë¦¬ë·°ë“±ë¡ì¼'] || ""
                        };

                        if (firebaseData.reviews) { // ë‚´ìš©ì´ ìˆëŠ” ê²½ìš°ë§Œ ì—…ë¡œë“œ
                            try {
                                await addDoc(collection(db, "reviews"), firebaseData);
                                count++;
                                status.innerText = `í˜„ì¬ ${count}ê°œ ì—…ë¡œë“œ ì™„ë£Œ...`;
                            } catch (e) {
                                console.error("ì˜¤ë¥˜:", e);
                            }
                        }
                    }
                    status.innerText = `âœ… ì„±ê³µ! ì´ ${count}ê°œì˜ ë¦¬ë·°ê°€ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.`;
                }
            });
        }
    </script>
</body>
</html>
