<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VENUSTARS ê³ ê° ë¦¬ë·° - 17,145ê°œ ì‹¤ì œ í›„ê¸°</title>
    <style>
        /* ê¸°ì¡´ ìŠ¤íƒ€ì¼ ì‹œíŠ¸ ë‚´ìš© ë™ì¼ */
        :root { --green-deep: #1a5c3a; --green-mid: #2d7a52; --green-light: #e8f5ee; --green-border: #1a5c3a; --accent-gold: #c9973a; --text-dark: #1a1a1a; --text-mid: #444; --text-light: #777; --bg: #f9f7f4; --white: #ffffff; --shadow: 0 2px 16px rgba(0,0,0,0.08); --radius: 12px; }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Noto Sans KR', sans-serif; background: var(--bg); color: var(--text-dark); min-height: 100vh; }
        .site-header { background: var(--green-deep); color: white; padding: 28px 20px 24px; text-align: center; position: relative; overflow: hidden; }
        .header-badge { display: inline-block; background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.3); border-radius: 20px; padding: 4px 14px; font-size: 11px; font-weight: 500; margin-bottom: 10px; color: rgba(255,255,255,0.9); }
        .site-title { font-family: 'Noto Serif KR', serif; font-size: clamp(26px, 6vw, 36px); font-weight: 700; color: white; }
        .search-section { padding: 22px 16px 16px; max-width: 720px; margin: 0 auto; }
        .search-wrapper { position: relative; }
        .search-input { width: 100%; padding: 14px 20px 14px 50px; border: 2.5px solid var(--green-border); border-radius: 50px; font-size: 15px; outline: none; }
        .review-card { background: white; border-radius: var(--radius); padding: 18px; margin-bottom: 10px; box-shadow: var(--shadow); border: 1px solid #f0f0f0; }
        .highlight { background: yellow; color: black; font-weight: bold; padding: 0 2px; }
        .spinner { display: inline-block; width: 18px; height: 18px; border: 2px solid rgba(255,255,255,0.4); border-top-color: white; border-radius: 50%; animation: spin 0.6s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        /* [ì´í•˜ ìŠ¤íƒ€ì¼ ìƒëµ - ê¸°ì¡´ ìŠ¤íƒ€ì¼ ìœ ì§€] */
    </style>
</head>
<body>

<header class="site-header">
    <div class="header-badge">ğŸ“‹ ê³µì‹ ì¸ì¦ ë¦¬ë·° Â· íŒŒì´ì–´ë² ì´ìŠ¤ ë°ì´í„°ë² ì´ìŠ¤</div>
    <h1 class="site-title">VENUSTARS Reviews</h1>
    <p class="site-subtitle">ì‹¤ì œ ê³ ê° 17,145ëª…ì˜ ì‚¬ìš© í›„ê¸°</p>
</header>

<div class="search-section">
    <div class="search-wrapper">
        <span class="search-icon">ğŸ”</span>
        <input type="search" class="search-input" id="searchInput" placeholder="ì˜ˆ: í•­ì•”, ê³ í˜ˆì••, ë‹¹ë‡¨, ê³ ì§€í˜ˆì¦">
    </div>
</div>

<div id="status-msg" style="text-align:center; color:#1a5c3a; font-weight:bold; margin-top:10px;">ë°ì´í„° ê¸ˆê³  ì—°ê²° ì¤‘...</div>
<div class="review-list" id="reviewList"></div>
<div class="load-more-wrap" id="loadMoreWrap" style="display:none; text-align:center; padding: 20px;">
    <button class="load-more-btn" id="loadMoreBtn" style="padding:10px 30px; background:#1a5c3a; color:white; border-radius:20px; border:none;">ë” ë³´ê¸°</button>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyBpqZEXkf6vq5cwpdeLADGTz8A0M3NKLjU",
        authDomain: "venustars.firebaseapp.com",
        projectId: "venustars",
        storageBucket: "venustars.firebasestorage.app",
        messagingSenderId: "171419456473",
        appId: "1:171419456473:web:d9b77b0608b5ef3201bfc8"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    let allReviews = [];
    let filteredReviews = [];
    let currentPage = 1;
    const PER_PAGE = 15;

    // 1. ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° (ê²€ìƒ‰ ì†ë„ ìµœì í™” í¬í•¨)
    async function loadReviews() {
        const status = document.getElementById('status-msg');
        const list = document.getElementById('reviewList');
        try {
            const querySnapshot = await getDocs(collection(db, "reviews"));
            allReviews = querySnapshot.docs.map(doc => {
                const data = doc.data();
                // ê²€ìƒ‰ ì†ë„ë¥¼ ìœ„í•´ ë¯¸ë¦¬ ê²€ìƒ‰ìš© í…ìŠ¤íŠ¸ë¥¼ í•©ì³ë‘¡ë‹ˆë‹¤.
                data._searchText = (
                    (data['ë¦¬ë·°ìƒì„¸ë‚´ìš©'] || data['reviews'] || '') + 
                    (data['ë“±ë¡ì'] || '')
                ).toLowerCase();
                return data;
            });

            status.innerText = `âœ… ì´ ${allReviews.length.toLocaleString()}ê°œì˜ ê³µì‹ ë¦¬ë·°ê°€ ì—°ê²°ë˜ì—ˆìŠµë‹ˆë‹¤.`;
            filteredReviews = [...allReviews];
            renderReviews();
        } catch (e) {
            status.innerText = "âŒ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨: " + e.message;
        }
    }

    // 2. í™”ë©´ì— ê·¸ë¦¬ê¸°
    window.renderReviews = function(append = false) {
        const list = document.getElementById('reviewList');
        const loadMoreWrap = document.getElementById('loadMoreWrap');
        const term = document.getElementById('searchInput').value.toLowerCase();
        
        if (!append) list.innerHTML = '';

        const start = (currentPage - 1) * PER_PAGE;
        const end = start + PER_PAGE;
        const slice = filteredReviews.slice(start, end);

        if (filteredReviews.length === 0) {
            list.innerHTML = '<p style="text-align:center; padding:50px;">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
            loadMoreWrap.style.display = 'none';
            return;
        }

        slice.forEach(r => {
            let content = r['ë¦¬ë·°ìƒì„¸ë‚´ìš©'] || r['reviews'] || '';
            const author = r['ë“±ë¡ì'] || r['id'] || 'ìµëª…';
            const date = r['ë¦¬ë·°ë“±ë¡ì¼'] || r['date'] || '';
            const stars = "â­".repeat(parseInt(r['êµ¬ë§¤ì í‰ì '] || 5));

            // í•˜ì´ë¼ì´íŠ¸ ì²˜ë¦¬
            if (term) {
                const regex = new RegExp(`(${term})`, "gi");
                content = content.toString().replace(regex, `<span class="highlight">$1</span>`);
            }

            const html = `
                <div class="review-card">
                    <div class="review-top">
                        <span class="stars">${stars}</span>
                        <span class="review-date" style="float:right; color:#ccc; font-size:12px;">${date}</span>
                    </div>
                    <div class="review-body" style="margin:10px 0; font-size:14px; line-height:1.6;">${content}</div>
                    <div class="review-author" style="font-size:12px; color:#888;">ì‘ì„±ì: ${author.toString().substring(0,3)}***</div>
                </div>
            `;
            list.insertAdjacentHTML('beforeend', html);
        });

        loadMoreWrap.style.display = (end < filteredReviews.length) ? 'block' : 'none';
    };

    // 3. ì‹¤ì‹œê°„ ê²€ìƒ‰ í•„í„°
    document.getElementById('searchInput').addEventListener('input', (e) => {
        const term = e.target.value.toLowerCase().trim();
        currentPage = 1;
        filteredReviews = allReviews.filter(r => r._searchText.includes(term));
        renderReviews();
    });

    // 4. ë” ë³´ê¸° ë²„íŠ¼
    document.getElementById('loadMoreBtn').addEventListener('click', () => {
        currentPage++;
        renderReviews(true);
    });

    loadReviews();
</script>

</body>
</html>
