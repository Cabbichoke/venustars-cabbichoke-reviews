/* â”€â”€ [ê¸°ì¡´ ì„¤ì • ìœ ì§€] â”€â”€ */
let allReviews = []; // ì—¬ê¸°ì— ë°ì´í„°ê°€ ì‹¤ì‹œê°„ìœ¼ë¡œ ìŒ“ì…ë‹ˆë‹¤.
let filteredReviews = [];

// ğŸš€ í•µì‹¬: í™”ë©´ì„ ë¨¼ì € ë„ìš°ëŠ” ë¡œë“œ ë°©ì‹
async function loadFullReviews() {
    const status = document.getElementById('countText');
    const list = document.getElementById('reviewList');

    try {
        // 1. ì²« í™”ë©´ìš© ë°ì´í„°(ìµœì‹  30ê°œ)ë§Œ ë¹›ì˜ ì†ë„ë¡œ ê°€ì ¸ì˜µë‹ˆë‹¤.
        const firstQuery = query(collection(db, "reviews"), orderBy("ë¦¬ë·°ë“±ë¡ì¼", "desc"), limit(30));
        const firstSnapshot = await getDocs(firstQuery);
        
        allReviews = firstSnapshot.docs.map(doc => {
            const data = doc.data();
            data._searchText = (data['ë¦¬ë·°ìƒì„¸ë‚´ìš©'] || '').toLowerCase();
            return data;
        });

        // 2. 30ê°œë§Œ ë¨¼ì € í™”ë©´ì— ë¿Œë¦½ë‹ˆë‹¤. (ì´ë•Œ ì‚¬ìš©ìëŠ” ë¡œë”©ì´ ëë‚¬ë‹¤ê³  ëŠë‚ë‹ˆë‹¤.)
        filteredReviews = [...allReviews];
        renderReviews(false);
        updateCount();

        // 3. ğŸ›‘ ì¤‘ìš”: ì´ì œ ì‚¬ìš©ìê°€ ë¦¬ë·°ë¥¼ ì½ëŠ” ë™ì•ˆ ë‚˜ë¨¸ì§€ 17,000ê°œë¥¼ ëª°ë˜ ê°€ì ¸ì˜µë‹ˆë‹¤.
        const remainingQuery = collection(db, "reviews");
        getDocs(remainingQuery).then(fullSnapshot => {
            // ì „ì²´ ë°ì´í„°ë¥¼ ë°±ê·¸ë¼ìš´ë“œì—ì„œ í•©ì¹©ë‹ˆë‹¤.
            const fullData = fullSnapshot.docs.map(doc => {
                const data = doc.data();
                data._searchText = (data['ë¦¬ë·°ìƒì„¸ë‚´ìš©'] || '').toLowerCase();
                return data;
            });
            
            allReviews = fullData; // ì´ì œ ê¸ˆê³ ì˜ ëª¨ë“  ë°ì´í„°ê°€ ë©”ëª¨ë¦¬ì— ë“¤ì–´ì™”ìŠµë‹ˆë‹¤.
            updateCount(); // "17,145ê°œ ì¤€ë¹„ ì™„ë£Œ"ë¡œ í‘œì‹œ ë³€ê²½
        });

    } catch (e) {
        console.error("ë¡œë”© ì¤‘ ì˜¤ë¥˜:", e);
    }
}
